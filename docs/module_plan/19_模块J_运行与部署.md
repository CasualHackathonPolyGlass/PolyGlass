# æ¨¡å—Jï¼šè¿è¡Œä¸éƒ¨ç½²ï¼ˆRunbookï¼‰

**æ¨¡å—ç¼–å·**ï¼š19
**ç‰ˆæœ¬**ï¼šv0.1

---

## 1. ç¯å¢ƒå˜é‡

### å¿…éœ€å˜é‡

```bash
# .env.local

# Polygon RPC ç«¯ç‚¹
RPC_URL=https://polygon-rpc.com

# æ•°æ®åº“è·¯å¾„
DATABASE_URL=file:./data/app.db
```

### å¯é€‰å˜é‡

```bash
# Gamma APIï¼ˆæœ‰é»˜è®¤å€¼ï¼‰
GAMMA_API_BASE=https://gamma-api.polymarket.com

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info

# æ‰«æé…ç½®
BLOCK_RANGE=20000
MIN_TRADES=100
```

### .env.example

```bash
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env.local å¹¶å¡«å†™å®é™…å€¼

# å¿…éœ€
RPC_URL=https://polygon-rpc.com
DATABASE_URL=file:./data/app.db

# å¯é€‰
GAMMA_API_BASE=https://gamma-api.polymarket.com
LOG_LEVEL=info
BLOCK_RANGE=20000
MIN_TRADES=100
```

---

## 2. æœ¬åœ°è¿è¡Œ

### å®Œæ•´æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone <repo-url>
cd polymarket-dashboard

# 2. å®‰è£…ä¾èµ–
pnpm install

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env.local
# ç¼–è¾‘ .env.localï¼Œå¡«å†™ RPC_URL

# 4. åˆå§‹åŒ–æ•°æ®åº“
pnpm db:migrate
# æˆ–
./scripts/migrate.sh

# 5. æ‹‰å–æ•°æ®
pnpm fetch
# æˆ–
./scripts/fetch-data.sh

# 6. éªŒè¯æ•°æ®
pnpm validate

# 7. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
# æˆ–
./scripts/dev.sh

# 8. æ‰“å¼€æµè§ˆå™¨
open http://localhost:3000/dashboard
```

---

## 3. è„šæœ¬è¯´æ˜

### scripts/ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ dev.sh           # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ build.sh         # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
â”œâ”€â”€ start.sh         # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
â”œâ”€â”€ fetch-data.sh    # æ‹‰å–é“¾ä¸Šæ•°æ®
â”œâ”€â”€ migrate.sh       # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ validate.sh      # æ•°æ®éªŒè¯
â””â”€â”€ demo.sh          # ä¸€é”®æ¼”ç¤ºï¼ˆè¯„å®¡ç”¨ï¼‰
```

### è„šæœ¬å†…å®¹

#### dev.sh

```bash
#!/bin/bash
set -e

echo "ğŸš€ Starting development server..."
pnpm next dev
```

#### fetch-data.sh

```bash
#!/bin/bash
set -e

echo "ğŸ“¦ Fetching market data from Gamma..."
pnpm ts-node scripts/fetch-markets.ts

echo "ğŸ”— Fetching OrderFilled logs from Polygon..."
pnpm ts-node scripts/fetch-logs.ts

echo "ğŸ”„ Processing and storing trades..."
pnpm ts-node scripts/process-trades.ts

echo "âœ… Data fetch complete!"
```

#### migrate.sh

```bash
#!/bin/bash
set -e

echo "ğŸ—„ï¸ Running database migrations..."
pnpm prisma migrate deploy

echo "âœ… Migrations complete!"
```

#### validate.sh

```bash
#!/bin/bash
set -e

echo "ğŸ” Validating data quality..."
pnpm ts-node scripts/validate.ts
```

#### demo.shï¼ˆä¸€é”®æ¼”ç¤ºï¼‰

```bash
#!/bin/bash
set -e

echo "ğŸ¬ Polymarket Smart Money Dashboard - Demo Setup"
echo "================================================"

# æ£€æŸ¥ç¯å¢ƒå˜é‡
if [ -z "$RPC_URL" ]; then
  echo "âŒ RPC_URL not set. Please set it in .env.local"
  exit 1
fi

# 1. å®‰è£…ä¾èµ–
echo "ğŸ“¦ Installing dependencies..."
pnpm install --frozen-lockfile

# 2. è¿ç§»æ•°æ®åº“
echo "ğŸ—„ï¸ Setting up database..."
pnpm prisma migrate deploy
pnpm prisma generate

# 3. æ‹‰å–æ•°æ®
echo "ğŸ”— Fetching data (this may take a few minutes)..."
pnpm ts-node scripts/fetch-markets.ts
pnpm ts-node scripts/fetch-logs.ts
pnpm ts-node scripts/process-trades.ts

# 4. éªŒè¯æ•°æ®
echo "ğŸ” Validating data..."
pnpm ts-node scripts/validate.ts

# 5. å¯åŠ¨æœåŠ¡
echo "ğŸš€ Starting server..."
echo "Open http://localhost:3000/dashboard"
pnpm next dev
```

---

## 4. package.json Scripts

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",

    "db:migrate": "prisma migrate deploy",
    "db:generate": "prisma generate",
    "db:studio": "prisma studio",

    "fetch": "ts-node scripts/fetch-all.ts",
    "fetch:markets": "ts-node scripts/fetch-markets.ts",
    "fetch:logs": "ts-node scripts/fetch-logs.ts",
    "process": "ts-node scripts/process-trades.ts",

    "validate": "ts-node scripts/validate.ts",

    "demo": "./scripts/demo.sh",
    "start:demo": "./scripts/demo.sh"
  }
}
```

---

## 5. è¯„å®¡ç¯å¢ƒè¿è¡Œ

### ä¸€æ¡å‘½ä»¤å¯åŠ¨

```bash
# æ¨èæ–¹å¼
pnpm start:demo

# æˆ–
./scripts/demo.sh
```

### éªŒè¯æ­¥éª¤

```bash
# 1. æ£€æŸ¥ trades æ•°é‡
curl http://localhost:3000/api/trades?limit=1 | jq '.pagination.total'
# åº”è¯¥ >= 100

# 2. æ£€æŸ¥æ•°æ®åº“
sqlite3 ./data/app.db "SELECT COUNT(*) FROM trades;"
# åº”è¯¥ >= 100

# 3. æ‰“å¼€é¡µé¢
open http://localhost:3000/dashboard
# åº”è¯¥çœ‹åˆ°äº¤æ˜“è¡¨æ ¼
```

---

## 6. å¸¸è§é—®é¢˜

### Q: pnpm install å¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

### Q: Prisma è¿ç§»å¤±è´¥

```bash
# é‡ç½®æ•°æ®åº“
rm -f ./data/app.db
pnpm prisma migrate deploy
```

### Q: RPC è¯·æ±‚å¤±è´¥

```bash
# æ£€æŸ¥ RPC_URL æ˜¯å¦æœ‰æ•ˆ
curl -X POST $RPC_URL \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

### Q: æ•°æ®ä¸è¶³ 100 æ¡

```bash
# å¢å¤§æ‰«æèŒƒå›´
BLOCK_RANGE=50000 pnpm fetch
```

---

## 7. ç›®å½•æƒé™

```bash
# ç¡®ä¿ scripts å¯æ‰§è¡Œ
chmod +x scripts/*.sh

# ç¡®ä¿ data ç›®å½•å­˜åœ¨
mkdir -p data logs
```

---

## 8. éªŒæ”¶ Checklist

- [ ] `.env.local` å·²é…ç½®
- [ ] `pnpm install` æˆåŠŸ
- [ ] `pnpm db:migrate` æˆåŠŸ
- [ ] `pnpm fetch` å®Œæˆï¼Œæ— é”™è¯¯
- [ ] `pnpm validate` å…¨éƒ¨é€šè¿‡
- [ ] `pnpm dev` å¯åŠ¨æˆåŠŸ
- [ ] `/dashboard` é¡µé¢å¯è®¿é—®
- [ ] Trades è¡¨æ ¼æ˜¾ç¤º â‰¥ 100 æ¡
